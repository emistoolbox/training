<!doctype html>
<html lang="en">
<head>
<!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css" >
    <title>WebSQL</title>
    <style>
    .text{
        width:100%;
        height:200px;
    }
    </style>
    <script src="js/jquery-3.3.1.min.js" ></script>
    <script>
        function sendQuery(){
            $("#error").hide();                
            $("#logs").hide();                
            $("#resultTable").empty();
            var data={
                    user: $('#username').val(),
                    password: $('#password').val(),
                    sql:  $('#sqlquery').val()
                }            
            $.ajax({
                type: "POST",
                url: "api/sql",
                data:  JSON.stringify(data),
                success: success,     
                headers: { 
                    'Accept': 'application/json'
                },
                fail: function() {
                    console.log( "error" );
                },
                dataType: "json",
                contentType: "application/json"
            });
        }
        function success(data){
            if (data.errorMessage){
                $("#error").show();                
                $("#error").text(data.errorMessage);
            }
            if (data.log && data.log.length>0){
                    $("#logs").show();
                    $("#logs").text(data.log.join());                
            }
            if (data.headers && data.rows)
                buildTable("resultTable",data.headers,data.rows);
        }
        function buildTable(tableId,headers,rows){
        
            var aux = "<thead class='thead-light'><tr>";
            for(var h=0;h<headers.length;h++)
            {
                var td1="<th scope='col'>"+headers[h]+"</th>";
                aux = aux+td1;
            }
            aux = aux +"</tr></thead><tbody>\n"
            $("#"+tableId).append(aux); 
            for(var i=0;i<rows.length;i++)
            {
                var tr="<tr scope='col'>";        
                for(var h=0;h<headers.length;h++)
                {
                    var td1="<td>"+rows[i][h]+"</td>";            
                    tr = tr+td1;
                }
                tr = tr +"</tr>\n"
                $("#"+tableId).append(tr) 
            }           
            $("#"+tableId).append("</tbody>"); 
        }
    </script>
</head>
<body>
<div class="container">
  <!-- Content here -->

<h1>Welcome to WebSQL</h1>
<br>
<br>

<form>
    <label for="user">DB username </label>
    <input id="username" />
    <label for="password">DB password </label>
    <input id="password" />

  <div class="form-group">
    <label for="sqlquery">Introduce your SQL </label>
    <textarea id="sqlquery" class="text"></textarea>
  </div>
 <input type="button" class="btn btn-primary" onclick="sendQuery()"value="Submit">
</form>
<br>
    <div class="alert alert-danger" role="alert" id="error" style="display:none">  
    </div>
<br>
<div class="table-responsive">
    <table id="resultTable" class="table table-bordered table-striped table-hover table-sm"></table>
</div>

<br>
    <div class="alert alert-primary" role="alert" id="logs" style="display:none">  
    </div>
</div>
<script src="js/bootstrap.bundle.min.js"></script>
</body>
</html>